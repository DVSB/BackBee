
parameters:
    bbapp.cachebootstrap.class: BackBuilder\Cache\File\Cache
    bbapp.cachecontrol.class: BackBuilder\Cache\DAO\Cache
    bbapp.cache_listener.class: BackBuilder\Event\Listener\CacheListener
    bbapp.cache.identifier_generator.class: BackBuilder\Cache\CacheIdentifierGenerator
    bbapp.cache.validator.class: BackBuilder\Cache\CacheValidator

services:

    cache.bootstrap:
        class:      %bbapp.cachebootstrap.class%
        arguments:  [{cachedir: "%bbapp.cache.dir%", cacheautogenerate: "%bbapp.cache.autogenerate%"}, "%bbapp.context%"]

    cache.control:
        class:      %bbapp.cachecontrol.class%
        arguments:  [{em: @em}, %bbapp.context%, @logging]

    cache.listener:
        class:      %bbapp.cache_listener.class%
        arguments:  [@bbapp, @cache.validator, @cache.identifier_generator]

    # Cache identifier generator
    cache.identifier_generator:
        class: %bbapp.cache.identifier_generator.class%
        arguments: [@service_container]

    cache.query_parameter.appender:
        class: BackBuilder\Cache\IdentifierAppender\QueryParameterAppender
        arguments: [@request, @em, 2, [content]]
        tags:
            - {name: cache.identifier.appender}

    cache.node_parameter.appender:
        class: BackBuilder\Cache\IdentifierAppender\NodeAppender
        arguments: [@em, [content]]
        tags:
            - {name: cache.identifier.appender}

    # Cache validator
    cache.validator:
        class: %bbapp.cache.validator.class%
        arguments: [@service_container]

    cache.request_method.validator:
        class: BackBuilder\Cache\Validator\RequestMethodValidator
        arguments: [@request, ['get'], cache_status]
        tags:
            - {name: cache.validator}

    cache.application_core.validator:
        class: BackBuilder\Cache\Validator\ApplicationCoreValidator
        arguments: [@bbapp, cache_status]
        tags:
            - {name: cache.validator}

    cache.pattern.validator:
        class: BackBuilder\Cache\Validator\PatternValidator
        arguments: [[]]
        tags:
            - {name: cache.validator}
